{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "cp .env.example .env && pnpm install --frozen-lockfile && pnpm run generate && pnpm run build --filter=webapp"
  },
  "deploy": {
    "startCommand": "pnpm exec turbo run db:push --filter=@trigger.dev/database && cd apps/webapp && pnpm start",
    "healthcheckPath": "/healthcheck",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "environments": {
    "production": {
      "build": {
        "NODE_ENV": "production"
      },
      "deploy": {
        "PORT": "${{PORT}}",
        "NODE_ENV": "production",
        "APP_ORIGIN": "https://${{RAILWAY_PUBLIC_DOMAIN}}",
        "LOGIN_ORIGIN": "https://${{RAILWAY_PUBLIC_DOMAIN}}",
        "API_ORIGIN": "https://${{RAILWAY_PUBLIC_DOMAIN}}",
        "DEV_OTEL_EXPORTER_OTLP_ENDPOINT": "https://${{RAILWAY_PUBLIC_DOMAIN}}/otel",
        "DATABASE_URL": "${{Postgres.DATABASE_URL}}",
        "DIRECT_URL": "${{Postgres.DATABASE_URL}}",
        "REDIS_HOST": "${{Redis.RAILWAY_PRIVATE_DOMAIN}}",
        "REDIS_PORT": "${{Redis.REDISPORT}}",
        "REDIS_PASSWORD": "${{Redis.REDISPASSWORD}}",
        "SESSION_SECRET": "${{SESSION_SECRET}}",
        "MAGIC_LINK_SECRET": "${{MAGIC_LINK_SECRET}}",
        "ENCRYPTION_KEY": "${{ENCRYPTION_KEY}}",
        "MANAGED_WORKER_SECRET": "${{MANAGED_WORKER_SECRET}}",
        "NODE_MAX_OLD_SPACE_SIZE": "4096",
        "GRACEFUL_SHUTDOWN_TIMEOUT": "1000",
        "TRIGGER_TELEMETRY_DISABLED": "1",
        "TRIGGER_CLI_TAG": "v4-beta",
        "TRIGGER_BOOTSTRAP_ENABLED": "1",
        "TRIGGER_BOOTSTRAP_WORKER_GROUP_NAME": "railway",
        "APP_LOG_LEVEL": "info",
        "REDIS_TLS_DISABLED": "true"
      }
    }
  }
}